<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Crowd Management System</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
  <!-- GSAP CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"></script>

  <style>
    body {
      background: linear-gradient(135deg, #edf6ff 0%, #e6f2ff 100%);
      min-height: 100vh;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      color: #333;
    }
    .navbar-brand {
        font-weight: 600;
    }
    .hero-section {
      min-height: 85vh;
      display: flex;
      align-items: center;
      padding-top: 80px;
      padding-bottom: 40px;
    }
    .hero-text-content h1 {
        font-weight: 700;
        line-height: 1.2;
        color: #102a43;
    }
    .hero-text-content p {
        font-size: 1.1rem;
        color: #486581;
        max-width: 500px;
    }
    .svg-hero-container {
      background-color: #ffffff;
      border-radius: 24px;
      padding: 2rem;
      box-shadow: 0 12px 40px rgba(0, 123, 255, 0.15);
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .action-btn {
      padding: 0.8rem 1.75rem;
      font-size: 1.05rem;
      font-weight: 500;
      border-radius: 0.5rem;
      transition: transform 0.2s ease-out, box-shadow 0.2s ease-out;
      margin: 0.5rem;
    }
    .action-btn:hover {
      transform: translateY(-4px);
      box-shadow: 0 10px 20px rgba(0, 123, 255, 0.2);
    }
    .btn-camera {
      background: linear-gradient(135deg, #28a745, #20c997);
      color: white;
      border: none;
    }
    .btn-camera:hover {
      background: linear-gradient(135deg, #218838, #1ea37a);
      color: white;
      box-shadow: 0 10px 20px rgba(40, 167, 69, 0.3);
    }
    .feature-card {
      background: white;
      border-radius: 1rem;
      padding: 1.5rem;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      height: 100%;
    }
    .feature-card:hover {
      transform: translateY(-8px);
      box-shadow: 0 8px 30px rgba(0, 123, 255, 0.15);
    }
    .feature-icon {
      width: 60px;
      height: 60px;
      background: linear-gradient(135deg, #007bff, #0056b3);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 1.5rem;
      margin-bottom: 1rem;
    }
    .stats-section {
      background: linear-gradient(135deg, #007bff, #0056b3);
      color: white;
      padding: 4rem 0;
    }
    .stat-item {
      text-align: center;
    }
    .stat-number {
      font-size: 2.5rem;
      font-weight: 700;
      display: block;
    }
    .upload-card {
        background-color: #ffffff;
        border-radius: 1rem;
        padding: 2rem;
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.08);
    }
    .upload-card h2 {
        font-weight: 600;
        color: #102a43;
    }
    #videoPreview {
      border: 2px dashed #cce0ff;
      background-color: #f8faff;
      max-height: 320px;
      border-radius: 0.5rem;
    }
    .status-message {
        font-weight: 500;
        min-height: 1.5em;
    }
    .footer {
        background-color: #0056b3;
        color: #ffffff;
    }
    .tech-badge {
      background: rgba(0, 123, 255, 0.1);
      color: #007bff;
      padding: 0.5rem 1rem;
      border-radius: 2rem;
      font-weight: 500;
      margin: 0.25rem;
      display: inline-block;
    }
  </style>
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow-sm fixed-top">
    <div class="container">
      <a class="navbar-brand fs-4" href="#">Crowd Management System</a>
      <div class="navbar-nav ms-auto">
        <a class="nav-link" href="#features">Features</a>
        <a class="nav-link" href="#uploadVideoSection">Upload</a>
        <a class="nav-link" href="#about">About</a>
      </div>
    </div>
  </nav>

  <!-- Hero Section -->
  <section class="hero-section">
    <div class="container">
      <div class="row align-items-center gy-5">
        <!-- Hero Text -->
        <div class="col-lg-6 col-md-12">
          <div id="heroTextContent" class="hero-text-content text-center text-lg-start">
            <h1 class="display-4 mb-3">Smart Crowd Management</h1>
            <p class="mb-4">
              Advanced AI-powered crowd analysis using YOLO11x for real-time monitoring, heatmap generation, and safety management in public spaces and events.
            </p>
            <div class="mb-4">
              <span class="tech-badge">YOLO11x</span>
              <span class="tech-badge">Real-time Analysis</span>
              <span class="tech-badge">Heatmap Generation</span>
              <span class="tech-badge">Safety Alerts</span>
            </div>
            <!-- Updated Button Section -->
            <div class="d-flex flex-wrap justify-content-center justify-content-lg-start">
              <button class="btn btn-camera action-btn" id="liveCameraBtn">
                <i class="bi bi-camera-video me-2"></i>Start Live Camera
              </button>
              <a href="#uploadVideoSection" class="btn btn-primary action-btn" id="getStartedBtn">
                <i class="bi bi-upload me-2"></i>Upload Video
              </a>
              <a href="#features" class="btn btn-outline-primary action-btn">Learn More</a>
            </div>
          </div>
        </div>
        <!-- Hero SVG -->
        <div class="col-lg-6 col-md-12 d-flex justify-content-center">
          <div id="heroSvgContainer" class="svg-hero-container">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512" fill="currentColor" style="width: 280px; height: auto; color: #0d6efd;">
              <path d="M96 128a128 128 0 1 1 256 0A128 128 0 1 1 96 128zM0 482.3C0 383.8 79.8 304 178.3 304h91.4C368.2 304 448 383.8 448 482.3c0 16.4-13.3 29.7-29.7 29.7H29.7C13.3 512 0 498.7 0 482.3zM472 200a72 72 0 1 1 144 0 72 72 0 1 1 -144 0zM480 512h128c26.5 0 48-21.5 48-48c0-59.6-48.4-108-108-108H532c-59.6 0-108 48.4-108 108c0 26.5 21.5 48 48 48z"/>
              <circle cx="320" cy="100" r="25" fill="#ffffff" stroke="#0d6efd" stroke-width="3"/>
              <circle cx="320" cy="100" r="15" fill="#0d6efd"/>
              <path d="M305 85 L335 85 L340 75 L300 75 Z" fill="#0d6efd"/>
            </svg>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Stats Section -->
  <section class="stats-section">
    <div class="container">
      <div class="row text-center">
        <div class="col-md-3 col-6 mb-4">
          <div class="stat-item">
            <span class="stat-number" data-count="92.7">0</span>
            <span>Accuracy Rate</span>
          </div>
        </div>
        <div class="col-md-3 col-6 mb-4">
          <div class="stat-item">
            <span class="stat-number" data-count="2100">0</span>
            <span>Model Trained on Images+</span>
          </div>
        </div>
        <div class="col-md-3 col-6 mb-4">
          <div class="stat-item">
            <span class="stat-number" data-count="42">0</span>
            <span>Events Monitored</span>
          </div>
        </div>
        <div class="col-md-3 col-6 mb-4">
          <div class="stat-item">
            <span class="stat-number" data-count="24">0</span>
            <span>Hours Real-time</span>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Features Section -->
  <section id="features" class="container py-5 my-5">
    <div class="text-center mb-5">
      <h2 class="display-5 fw-bold text-primary mb-3">Powerful Features</h2>
      <p class="lead text-muted">Comprehensive crowd analysis tools for enhanced safety and management</p>
    </div>
    <div class="row g-4">
      <div class="col-lg-4 col-md-6">
        <div class="feature-card">
          <div class="feature-icon">
            <i class="bi bi-camera-video"></i>
          </div>
          <h4 class="fw-bold mb-3">Real-time Monitoring</h4>
          <p class="text-muted">Live video analysis with instant crowd density detection and movement tracking using advanced YOLO11x algorithms.</p>
        </div>
      </div>
      <div class="col-lg-4 col-md-6">
        <div class="feature-card">
          <div class="feature-icon">
            <i class="bi bi-thermometer-half"></i>
          </div>
          <h4 class="fw-bold mb-3">Heatmap Generation</h4>
          <p class="text-muted">Visual density maps showing crowd concentration patterns and high-traffic areas for better space management.</p>
        </div>
      </div>
      <div class="col-lg-4 col-md-6">
        <div class="feature-card">
          <div class="feature-icon">
            <i class="bi bi-shield-check"></i>
          </div>
          <h4 class="fw-bold mb-3">Safety Alerts</h4>
          <p class="text-muted">Automated alerts for overcrowding, unusual behavior patterns, and potential safety risks in real-time.</p>
        </div>
      </div>
      <div class="col-lg-4 col-md-6">
        <div class="feature-card">
          <div class="feature-icon">
            <i class="bi bi-graph-up"></i>
          </div>
          <h4 class="fw-bold mb-3">Analytics Dashboard</h4>
          <p class="text-muted">Comprehensive analytics with detailed reports, trends, and insights for data-driven decision making.</p>
        </div>
      </div>
      <div class="col-lg-4 col-md-6">
        <div class="feature-card">
          <div class="feature-icon">
            <i class="bi bi-people"></i>
          </div>
          <h4 class="fw-bold mb-3">Crowd Tracking</h4>
          <p class="text-muted">Individual and group movement tracking with path analysis and behavioral pattern recognition.</p>
        </div>
      </div>
      <div class="col-lg-4 col-md-6">
        <div class="feature-card">
          <div class="feature-icon">
            <i class="bi bi-lightning"></i>
          </div>
          <h4 class="fw-bold mb-3">Fast Processing</h4>
          <p class="text-muted">High-speed video processing with minimal latency for immediate results and rapid response capabilities.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Upload Section -->
  <section id="uploadVideoSection" class="container py-5 my-4">
    <div class="upload-card mx-auto" style="max-width: 600px;">
      <h2 class="mb-4 text-center">Upload Video for Crowd Analysis</h2>
      <div class="mb-3">
        <label for="videoInput" class="form-label fs-5">Select Video File</label>
        <input type="file" accept="video/*" class="form-control form-control-lg" id="videoInput"/>
        <div class="form-text">Supported formats: MP4, MOV, AVI (Max size: 100MB)</div>
      </div>
      <video id="videoPreview" controls class="w-100 rounded mb-3" style="display: none;"></video>
      <button class="btn btn-primary w-100 py-2 fs-5 action-btn" id="uploadBtn">
        <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true" style="display: none;"></span>
        Upload & Analyze
      </button>
      <div class="mt-3 text-center status-message" id="uploadStatus"></div>
    </div>
  </section>

  <!-- About Section -->
  <section id="about" class="bg-light py-5">
    <div class="container">
      <div class="row align-items-center">
        <div class="col-lg-6">
          <h2 class="display-6 fw-bold text-primary mb-4">About Our Technology</h2>
          <p class="lead mb-4">Our crowd management system leverages cutting-edge AI technology to provide comprehensive crowd analysis and safety monitoring solutions.</p>
          <div class="row">
            <div class="col-6 mb-3">
              <h5 class="fw-bold">AI-Powered</h5>
              <p class="text-muted small">Advanced machine learning algorithms</p>
            </div>
            <div class="col-6 mb-3">
              <h5 class="fw-bold">Real-time</h5>
              <p class="text-muted small">Instant analysis and alerts</p>
            </div>
            <div class="col-6 mb-3">
              <h5 class="fw-bold">Scalable</h5>
              <p class="text-muted small">Works for any event size</p>
            </div>
            <div class="col-6 mb-3">
              <h5 class="fw-bold">Accurate</h5>
              <p class="text-muted small">99.5% detection accuracy</p>
            </div>
          </div>
        </div>
        <div class="col-lg-6">
          <div class="bg-white p-4 rounded-3 shadow">
            <h5 class="fw-bold mb-3">Use Cases</h5>
            <ul class="list-unstyled">
              <li class="mb-2"><i class="bi bi-check-circle text-success me-2"></i>Concert & Festival Management</li>
              <li class="mb-2"><i class="bi bi-check-circle text-success me-2"></i>Shopping Mall Monitoring</li>
              <li class="mb-2"><i class="bi bi-check-circle text-success me-2"></i>Airport & Station Security</li>
              <li class="mb-2"><i class="bi bi-check-circle text-success me-2"></i>Sports Event Safety</li>
              <li class="mb-2"><i class="bi bi-check-circle text-success me-2"></i>Emergency Evacuation Planning</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="footer text-center py-4">
    <div class="container">
      <p class="mb-0">&copy; 2025 Crowd Management System. AI-Powered Safety Solutions.</p>
    </div>
  </footer>

  <script>
    gsap.registerPlugin(ScrollTrigger);

    window.addEventListener('DOMContentLoaded', () => {
      // Hero Text Animation
      gsap.from("#heroTextContent > *", {
        opacity: 0,
        y: 30,
        duration: 0.7,
        stagger: 0.2,
        ease: "power2.out"
      });

      // Hero SVG Animation
      gsap.from("#heroSvgContainer", {
        opacity: 0,
        scale: 0.85,
        duration: 1,
        delay: 0.4,
        ease: "elastic.out(1, 0.75)"
      });

      // Stats Counter Animation
      gsap.utils.toArray('.stat-number').forEach(stat => {
        const target = stat.getAttribute('data-count');
        gsap.to(stat, {
          innerText: target,
          duration: 2,
          ease: "power2.out",
          snap: { innerText: 1 },
          scrollTrigger: {
            trigger: stat,
            start: "top 80%",
            toggleActions: "play none none none"
          },
          onUpdate: function () {
            if (target.includes('.')) {
              stat.innerText = Number(stat.innerText).toFixed(1);
            }
          }
        });
      });

      // Feature Cards Animation
      gsap.from(".feature-card", {
        opacity: 0,
        y: 50,
        duration: 0.6,
        stagger: 0.1,
        scrollTrigger: {
          trigger: "#features",
          start: "top 70%",
          toggleActions: "play none none none"
        }
      });

      // Upload Section Animation
      gsap.from("#uploadVideoSection .upload-card", {
        opacity: 0,
        y: 50,
        duration: 0.8,
        scrollTrigger: {
          trigger: "#uploadVideoSection",
          start: "top 80%",
          toggleActions: "play none none none"
        }
      });
    });

    // Live Camera Button Handler
    document.getElementById('liveCameraBtn').addEventListener('click', function() {
      gsap.to(this, { scale: 0.95, duration: 0.1, yoyo: true, repeat: 1 });
      
      // Show loading state
      this.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Starting Camera...';
      this.disabled = true;
      
      // Redirect to live camera page
      setTimeout(() => {
        window.location.href = '/live_camera';
      }, 1000);
    });

    const videoInput = document.getElementById('videoInput');
    const videoPreview = document.getElementById('videoPreview');
    const uploadBtn = document.getElementById('uploadBtn');
    const uploadStatus = document.getElementById('uploadStatus');
    const spinner = uploadBtn.querySelector('.spinner-border');

    videoInput.addEventListener('change', function(event) {
      const file = event.target.files[0];
      if (file && file.type.startsWith('video/')) {
        const url = URL.createObjectURL(file);
        videoPreview.src = url;
        videoPreview.style.display = 'block';
        uploadStatus.textContent = 'Video selected. Ready to analyze.';
        uploadStatus.className = 'mt-3 text-center status-message text-muted';
        gsap.fromTo(videoPreview, {opacity:0, height: 0}, {opacity:1, height: 'auto', duration: 0.4, ease: 'power1.out'});
      } else {
        videoPreview.src = '';
        videoPreview.style.display = 'none';
        if (file) {
          uploadStatus.textContent = 'Invalid file. Please select a video (MP4, MOV, AVI).';
          uploadStatus.className = 'mt-3 text-center status-message text-danger fw-bold';
        } else {
          uploadStatus.textContent = '';
          uploadStatus.className = 'mt-3 text-center status-message';
        }
      }
    });

    uploadBtn.addEventListener('click', async () => {
      const file = videoInput.files[0];
      if (!file) {
        uploadStatus.textContent = 'Please select a video file first!';
        uploadStatus.className = 'mt-3 text-center status-message text-danger fw-bold';
        gsap.fromTo(uploadStatus, {x: -8}, {x: 8, duration: 0.07, yoyo: true, repeat: 5, ease: 'power1.inOut', clearProps:"x"});
        return;
      }
      if (!file.type.startsWith('video/')) {
        uploadStatus.textContent = 'Invalid file type. Please select a video.';
        uploadStatus.className = 'mt-3 text-center status-message text-danger fw-bold';
        return;
      }

      const formData = new FormData();
      formData.append('video', file);

      uploadStatus.textContent = 'Processing video... Analyzing crowd patterns.';
      uploadStatus.className = 'mt-3 text-center status-message text-info';
      spinner.style.display = 'inline-block';
      uploadBtn.disabled = true;
      gsap.to(uploadBtn, { y: -2, boxShadow: "0 4px 10px rgba(0,123,255,0.2)", duration: 0.1});

      try {
        const response = await fetch('/upload', {
          method: 'POST',
          body: formData,
        });

        if (response.ok) {
          const result = await response.json();
          uploadStatus.textContent = `Analysis Complete! ${result.message || 'Crowd analysis results are ready.'}`;
          uploadStatus.className = 'mt-3 text-center status-message text-success fw-bold';
          gsap.fromTo(uploadStatus, {scale: 0.9, opacity:0}, {scale: 1, opacity:1, duration: 0.4, ease: 'back.out(1.7)'});
          setTimeout(() => {
            window.location.href = '/live_preview';
          }, 2000);
        } else {
          const errorResult = await response.json().catch(() => ({ detail: "Server error. Please try again." }));
          uploadStatus.textContent = `Error ${response.status}: ${errorResult.detail || response.statusText}`;
          uploadStatus.className = 'mt-3 text-center status-message text-danger fw-bold';
        }
      } catch (error) {
        console.error('Upload Error:', error);
        uploadStatus.textContent = 'Upload failed. Check your connection and try again.';
        uploadStatus.className = 'mt-3 text-center status-message text-danger fw-bold';
      } finally {
        spinner.style.display = 'none';
        uploadBtn.disabled = false;
        gsap.to(uploadBtn, { y: 0, boxShadow: "0 10px 20px rgba(0,123,255,0.2)", duration: 0.2});
      }
    });

    document.getElementById('getStartedBtn').addEventListener('click', function(e) {
      e.preventDefault();
      document.getElementById('uploadVideoSection').scrollIntoView({ behavior: 'smooth', block: 'start' });
      gsap.to(this, { y: -2, duration: 0.1, yoyo: true, repeat: 1, ease: 'power1.inOut'});
    });

    // Smooth scrolling for navbar links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
          target.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
      });
    });
  </script>
</body>
</html>
